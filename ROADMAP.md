# M5Dial BLE Mouse - 開発ロードマップ

## 現在の状況

### 実装済み機能 ✅
- **タッチドラッグ** → マウスカーソル移動（感度調整済み）
- **タップ** → 左クリック
- **ダブルタップ** → 右クリック（250ms判定）
- **安定したBLE接続** - ESP32-NimBLE-Mouse使用
- **高FPS動作** - 5ms delay
- **プロジェクト管理** - Git/GitHub統合

### 既知の問題 ⚠️
- **エンコーダークラッシュ**: `M5Dial.Encoder.read()`でメモリ違反
- **エンコーダー機能**: 現在完全に無効化

## 短期目標（次のマイルストーン）

### 1. エンコーダースクロール機能復活 🎯
**優先度**: 最高

#### 解決アプローチ
1. **公式サンプルベースの安全な実装**
   - M5Dialライブラリの公式`encoder.ino`を参考
   - `M5Dial.begin(cfg, true, false)` で明示的エンコーダー有効化
   - シンプルな差分検出方式採用

2. **初期化改善**
   - エンコーダー初期化をBLE初期化前に移動
   - ハードウェア安定待ち時間追加
   - 初期化順序の最適化

3. **エラーハンドリング強化**
   - C++例外処理削除（組み込みでは非推奨）
   - 範囲チェックによる異常値フィルタ
   - フェイルセーフ機能実装

#### 実装ステップ
- [ ] 開発用ブランチ作成
- [ ] 公式サンプルベースの基本実装
- [ ] BLEマウスとの統合テスト
- [ ] 安定性確認
- [ ] 感度調整とパフォーマンス最適化

### 2. 設定UI追加 🎛️
**優先度**: 中

- タッチスクリーンでの感度調整UI
- 設定の永続化（EEPROM/NVS）
- 視覚的なフィードバック

## 中期目標

### 3. 安定性・UX向上 📈
- **接続管理改善**
  - 自動再接続機能
  - 接続状態の視覚化
  - バッテリー残量表示

- **パフォーマンス最適化**
  - メモリ使用量削減
  - レスポンス時間改善
  - 省電力モード

## 長期目標

### 4. 高度な機能 🎯
- **マルチデバイス対応**
  - 複数デバイスへの同時接続
  - デバイス切り替え機能

## 技術的課題

### 解決予定の課題
- [ ] エンコーダー読み取りの安定化
- [ ] メモリ使用量最適化
- [ ] 接続遅延の短縮

### 調査が必要な項目
- [ ] macOS以外のOS対応状況

## 開発環境・ツール

- Arduino IDE 2.x
- ESP32-NimBLE-Mouse ライブラリ
- Git/GitHub
- Claude Code

---

*最終更新: 2025年8月17日*  
*次回見直し予定: エンコーダー機能実装後*
